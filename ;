import tkinter as tk
from math import sqrt, floor, pi, sin, cos
from random import random

root = tk.Tk()
root.title('test')

mycanvas = tk.Canvas(root, width=300, height=300)
mycanvas.pack()


def dist(a, b):
    return sqrt((a[0] - b[0])*(a[0] - b[0]) + (a[1] - b[1]) * (a[1] - b[1]))


def poissionSample(sx, sy, ex, ey, num, minRange) -> [[]]:
    k = 30
    if sx > ex:
        sx, ex = ex, sx
    if sy > ey:
        sy, ey = ey, sy

    # maxRange = 2 * minRange
    w = minRange / sqrt(2)
    xlen = ex - sx
    ylen = ey - sy
    cols = floor(xlen / w)
    rows = floor(ylen / w)
    cells = [[-1 for i in range(cols)] for i in range(rows)]
    activeList = []
    pos = [xlen * random(), ylen * random()]
    x = floor(pos[0] / w)
    y = floor(pos[1] / w)
    cells[x][y] = pos
    activeList.append(pos)

    while len(activeList) > 0:
        idx = floor(len(activeList) * random())
        curPos = activeList[idx]
        found = False
        for i in range(k):
            offsetX = cos(2*pi*random())
            offsetY = sin(2*pi*random())
            mag = random() * minRange + minRange
            samplePoint = [curPos[0] + offsetX*mag, curPos[1] + offsetY*mag]
            sampleX = floor(samplePoint[0] / w)
            sampleY = floor(samplePoint[1] / w)
            if sampleX < 0 or sampleY < 0 or sampleX >= cols or sampleY >= rows:
                continue
            flag = True
            for i in range(sampleX-1, sampleX+1):
                for j in range(sampleY-1, sampleY+1):
                    if i == sampleX and j == sampleY:
                        continue
                    if i < 0 or j < 0 or i >= cols or j >= rows:
                        continue
                    if cells[i][j] == -1:
                        continue
                    curDist = dist(cells[i][j], samplePoint)
                    if curDist < minRange:
                        flag = False
                        break
            if flag:
                cells[sampleX][sampleY] = samplePoint
                activeList.append(samplePoint)
                found = True
                break

        if not found:
            del activeList[idx]

    for row in cells:
        for samplePoint in row:
            if samplePoint == -1:
                continue
            mycanvas.create_oval(samplePoint[0],samplePoint[1],samplePoint[0]+10,samplePoint[1]+10, fill='red')
    return


print(poissionSample(0, 0, 300, 300, 20, 100))
root.mainloop()

